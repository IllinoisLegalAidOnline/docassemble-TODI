metadata:
  title: Transfer on death instrument - TODI
  short title: TODI
  comment:  This program helps you prepare a Transfer On Death Instrument for your property located in Illinois. 
  authors:
    - Vivian McNaughton
    - Matt Newsted
---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.ALToolbox:phone-number-validation.yml
  - docassemble.ILAO:ilao-interview-framework.yml
  - docassemble.ILAO:shared-basic-questions.yml
---
objects:
  - user: ALIndividual
  - todi_property: ALAddress
  - ownership_types: DAList.using(there_are_any=True)
  - beneficiaries: ALPeopleList.using(object_type=ALIndividual, complete_attribute=['complete'], there_are_any=True)
  - beneficiaries[i].successor_beneficiary: ALIndividual
  - witnesses: ALPeopleList.using(there_are_any=True)
  - court_list: ALCourtLoader.using(file_name='docassemble.ILAO:data/sources/il_courts.xlsx')
---
code: |
  ilao_easy_form_title = "Transfer on death instrument - TODI"
  ilao_easy_form_url = "https://www.illinoislegalaid.org/legal-information/transfer-death-instrument-or-todi"
  github_user = 'IllinoisLegalAidOnline'
  github_repo_name = 'docassemble-TODI'
---
sections:
  - review_answers: Review your answers
---
sections:
  - section_intro: Start
  - section_user: About you
  - section_property: Property
  - section_beneficiaries: Beneficiaries
  - section_witnesses: Witnesses
  - section_download: Download
---
# interview order block
mandatory: True
code: |
  nav.set_section('section_intro')
  sees_nav_bar
  set_progress(5)
  todi_requirements
  how_to_use
  accept_terms
  if illinois_property == False:
    not_in_illinois
  nav.set_section('section_user')
  user.name.first
  user.address.address
  user_county_edit
  if user.include_phone == True:
    user.phone_number
  if user.include_email == True:
    user.email
  if user.marital_status == "Married":
    married_note
  nav.set_section('section_property')
  todi_property.address
  check_county
  todi_property.pin
  todi_property.description
  if other_owners_check == "multiple":   
    if shared_owners_type == "Tenancy in common":
      common_explanation
    elif shared_owners_type == "Joint tenancy":
      joint_explanation
    elif shared_owners_type == "Tenancy by the entirety":
      entirety_explanation
    elif shared_owners_type == "I do not know":
      unknown_kickout
  nav.set_section('section_beneficiaries')
  beneficiaries.gather()
  share_calculator
  nav.set_section('section_witnesses')
  #reconsider('beneficiary_count')
  if first_witness_known == True:
    witnesses[0].name.first
    if first_witness_address_known == True:
      witnesses[0].address.address 
    if second_witness_known == True:
      witnesses[1].name.first
      if second_witness_address_known == True:
        witnesses[1].address.address
  set_second_witness_unknown
  nav.set_section('section_download')
  if beneficiary_count  == 1:
    percent_default
  get_docs_screen
---
id: welcome
question: |
  Transfer on death instrument - TODI
subquestion: |
  Welcome to Illinois Legal Aid Online's **Transfer on death instrument - TODI** Easy Form.

  This program helps you prepare a Transfer On Death Instrument (TODI) for your property located in Illinois. 
  
  A TODI lets you to transfer real estate to your loved ones without including it in your will. This means your loved ones can avoid having to go to court to divide up your property after your death.
  
  The form you create can only be used in Illinois.
field: sees_nav_bar
---
id: instructions
continue button field: how_to_use
question: |
  Instructions
subquestion: |
  Set aside 10 to 20 minutes to finish this program. You can log in and save your work to return to later. 

  After you download your form, you will need to sign it in front of 2 witnesses and a notary public, record the TODI with your county's Recorder of Deeds, and give copies to your beneficiaries.
  
  ${ collapse_template(help_example) }  

  Click on **{green words}** to learn what they mean. Some questions have a question mark in a circle ${ fa_icon("question-circle", color_css="#0DCAF0" ) } that also gives help.
---
template: help_example

subject: |

  **You can expand sections like this to show more information.**

content: |  

  This is an example of help. Click again to hide.
---
id: accept terms
question: |
  Terms of use
subquestion: |
  This program does not provide legal advice. It does not take the place of advice from a lawyer.

  Using this program does not create an attorney-client relationship between you and Illinois Legal Aid Online or its employees.

  ${ collapse_template(get_legal_help) }  

fields:
  - To continue, you must accept the [**terms of use**](https://www.illinoislegalaid.org/about/terms-of-use).: accept
    datatype: checkboxes
    none of the above: False
    minlength: 1
    choices:
      - I accept the terms of use.
    validation messages:
      minlength: |
        You cannot continue unless you agree to the terms of use.
continue button field: accept_terms
---
template: get_legal_help
subject: |
  **What if I need legal advice?**
content: |  
  If you have questions or concerns about your legal problem and want legal advice you should talk to a lawyer.
 
  Use [**Get Legal Help**](https://www.illinoislegalaid.org/get-legal-help) to find free or low-cost legal services in your area.
---
id: todi requirements
continue button field: todi_requirements
question: |
  Information about TODIs
subquestion: |
  A TODI can be used to transfer any type of real property. This means a house, a condo, a building, or a parcel of land.
  
  To complete this program, you will need to know: 

  * Your Property Identification Number ("PIN"), which should be on your deed and other documents recorded against the property. You can obtain the PIN from your County Clerk's Office, Assessor's Office, and sometimes at your county's website.

  * The legal description of the property. You can find this in the property deed or other documents recorded against the property. If you do not have these, you can find them at the office of County Recorder of Deeds or their website. For example, in Cook County, you would go to the Recorder of Deeds website and search for your deed using your PIN. You could then view an image of the deed which contains the legal description. 
---
id: illinois property
question: |
  Is the property you want to include in the TODI located in Illinois? 
fields:
  - no label: illinois_property
    datatype: yesnoradio
---
id: not in illinois
event: not_in_illinois
question: |
  Sorry
subquestion: |
  You can only use this program for property located in Illinois.
buttons:
  - Exit: exit
  - Restart: restart
---
id: user name
question: |
  What is your name?
fields:
  - First: user.name.first
  - Middle: user.name.middle
    required: False
  - Last: user.name.last
---
id: user address
question: |
  What is your mailing address?
subquestion: |
  This does not have to be the address of the property you're transferring.
fields:
  - Street address: user.address.address
    address autocomplete: True
  - Address line 2: user.address.unit
    required: False
  - City: user.address.city
  - State: user.address.state
    code: |
      states_list() 
  - ZIP code: user.address.zip
  - County: user.address.county
---
id: user phone check
question: |
  Do you want to include your phone number in the TODI?
fields:
  - no label: user.include_phone
    datatype: yesnoradio
---
id: user phone number
question: |
  What is your phone number?
fields:
  - Phone number: user.phone_number
    datatype: al_international_phone
---
id: user email check
question: |
  Do you want to include your email address in the TODI?
fields:
  - no label: user.include_email
    datatype: yesnoradio
---
id: user email address
question: |
  What is your email address?
fields: 
  - Email: user.email
    datatype: email
---
id: user marital status
question: |
  What is your marital status?
subquestion: |
  If you are married, your marriage may affect ownership of the property.
field: user.marital_status
choices:
  - Single
  - Married
  - Legally separated by a judge: Legally separated by a judge
    help: |
      A legal separation is a court-ordered arrangement for a married couple to live separately and separate their assets. If you live apart from your spouse but were not separated by a judge, you are still considered married.
  - Divorced
  - Widowed
---
id: married note
continue button field: married_note
question: |
  Note about property for married people
subquestion: |
  If your spouse outlives you they may be able to stop your TODI, even if you have been separated for a long time. If they stop the TODI, your spouse will receive a share of the property. 
  To learn more, read ILAO's articles about:
  
  * [**What happens when I die without a will?**](https://www.illinoislegalaid.org/legal-information/what-happens-when-i-die-without-will/)
  * [**Giving someone your house when you die**](https://www.illinoislegalaid.org/legal-information/giving-someone-your-house-when-you-die)
  * [**A will as a legal document to explain my wishes after I die**](https://www.illinoislegalaid.org/legal-information/will-legal-document-explain-my-wishes-after-i-die)
---
id: property address
question: |
  What is the address of the property you want to include in the TODI?
fields:
  - Street address: todi_property.address
    address autocomplete: True
  - Address line 2: todi_property.unit
    required: False
  - City: todi_property.city
  - State: todi_property.state
    code: |
      states_list() 
  - ZIP code: todi_property.zip
  - County: todi_property.county
---
template: county_lookup_help
subject: |
  **How do I look up the county?**
content: |  
  You can use this **[City-to-County Finder](https://www.statsamerica.org/CityCountyFinder/)** to find the county.
---
depends on:
  - todi_property.county
id: property county
continue button field: property_county
question: |
  In which county is the property located?
subquestion: |
  We could not find the county for the property at ${ todi_property.on_one_line(bare=True) } in the list of Illinois counties, but you can select it here.

  ${ collapse_template(county_lookup_help) }
fields:
  - no label: trial_court_index
    code: |
      court_county_lookup()
---   
code: |
  def court_county_lookup(lowercase=False):
    all_court_counties = court_list._load_courts()['address_county'].items()
    filtered_courts = [(-1, "cook")] if lowercase else [(-1, "Cook")]
    for court in all_court_counties:
      if court[1] != "Cook":
        court_name = court[1].lower() if lowercase else court[1]
        filtered_courts.append((court[0],court_name))
    return sorted( filtered_courts, key=lambda y: y[1])
---
code: |
  def get_county_list(lowercase=False):
    county_list = [*set(court_list._load_courts()['address_county'])]
    county_list.sort()
    return county_list
---
depends on:
  - user.address.county
sets:
  - add_county
code: |
  user_county_name = user.address.county.lower()
  
  if user_county_name.endswith(" county"):
    add_county = False
  else:
    add_county = True
    
---
sets:
  - user_county_edit
code: |
  if add_county == True:
    user.address.county = user.address.county + " County"
  user_county_edit = True
---
depends on:
  - trial_court_index
  #- todi_property.county
code: |
  county_name = todi_property.county.lower()
  
  needs_addition = True
  if county_name.endswith(" county"):
    county_name = todi_property.county.lower()[0:-7]
    needs_addition = False

  county_found = False
  for item in get_county_list():
    if county_name == str(item).lower():
      county_found = True

  if county_found == False:
    trial_court_index
    if trial_court_index == "-1":
      trial_court = court_list.as_court('trial_court', 15)
    else:
      trial_court = court_list.as_court('trial_court', trial_court_index)
    todi_property.county = trial_court.address.county + " County"  
  else: 
    if needs_addition == True:
      todi_property.county = todi_property.county + " County"
  check_county = True
---
reset:
  - check_county
  - county_name
  - county_found
  #- trial_court
---
depends on:
  - trial_court_index
code: |
  if trial_court_index == "-1":
    trial_court = court_list.as_court('trial_court', 15)
  else:
    trial_court = court_list.as_court('trial_court', trial_court_index)
---
id: property pin
question: |
  What is the Property Identification Number ("PIN") for this property? 
subquestion: |
  You can find your PIN at your County Clerk's Office or Assessor's Office, and sometimes at your county's website. If your property is in one of the counties below, click their website to look up your PIN: 

  * [**Cook County**](http://www.cookcountypropertyinfo.com/)
  * [**DuPage County**](http://www.dupageco.org/PropertyInfo/PropertyLookup.aspx)
  * [**Kane County**](https://lrs.kanecountyrecorder.net/)
  * [**Lake County**](http://www.lakecountyil.gov/154/Chief-County-Assessment-Office)
  * [**McHenry County**](http://www.mchenrycountygis.org/Athena)
  * [**Will County**](https://www.willcountysoa.com/section/Property-Search-Portal)
  
  If your property is in a different county, search online to find your county's Recorder of Deeds website and see if you can look up your PIN for free online.
  
  The format of a PIN is 12-12-123-123-1234.
fields:
  - PIN: todi_property.pin
---
id: property description
question: |
  What is the legal description of the property?
subquestion: |
  You can find the legal description on the deed or other property documents. These can be found at the office of the Recorder of Deeds in the county where the property is located. For example, in Cook County, you would go to the Recorder of Deeds website and search for your deed using your PIN. You could then view an image of the deed which contains the legal description. 

  Note: Be careful in writing the property description. You should copy the legal description exactly. You may wish to compare the deed to other documents (such as a mortgage) to see if the descriptions are the same. If your property is in one of the counties listed below, click their website to look up the legal description.

  * [**Cook County**](http://cookrecorder.com/"»Cook County Recorder of Deeds)
  * [**DuPage County**](https://www.dupagecounty.gov/elected_officials/recorder/)
  * [**Kane County**](https://lrs.kanecountyrecorder.net/)
  * [**Lake County**](https://www.lakecountyil.gov/258/Recorder-of-Deeds)
  * [**McHenry County**](https://www.co.mchenry.il.us/county-government/departments-a-i/county-recorder)
  * [**Will County**](https://www.willcountysoa.com/section/Property-Search-Portal)

  If your property is in a different county, search online to find your county's Recorder of Deeds website and see if you can look up the legal description for free online.
fields:
  - Legal description: todi_property.description
    input type: area
    rows: 10
---
id: other owners check
question: |
  Do you own this property by yourself, or do you own it with someone else?
field: other_owners_check
choices:
  - I am the only owner.: sole
  - I share ownership of this property with someone else.: multiple
---
sets:
  - ownership_types[i]
depends on:
  - user.marital_status
code: |
  if user.marital_status == "Married":
    ownership_types = [
      {"Tenancy in common": "Tenancy in common",
        "help": "**Tenants in common** may have equal or unequal shares. For example, one owner could own an 80% share of the property and another owner could own a 20% share of the property. These percentages must add up to 100%. Tenant-in-common owners do not have the right of survivorship. If a tenant in common passes away, their share of the property goes to their estate instead of the remaining tenants in common."},
      {"Joint Tenancy": "Joint Tenancy",
        "help": "**Joint tenant** owners all own an equal share of the property. For example, if there are three joint tenant owners, each owner owns 1/3rd of the property. Joint tenant owners also have what the law calls a 'right of survivorship.' This means that when a joint tenant owner passes away, their share of the property goes to the other joint tenant owners."},
      {"Tenancy by the entirety": "Tenancy by the entirety",
        "help": "A **tenancy by the entirety** can only exist when a property is owned by a married couple. It is similar to a joint tenancy. If one spouse passes away, the other spouse gets their share of the property. The property's deed must explicitly state the couple owns the property as tenants by the entirety."},
      {"I do not know": "I do not know."}]   
  else:
    ownership_types = [
      {"Tenancy in common": "Tenancy in common",
        "help": "**Tenants in common** may have equal or unequal shares. For example, one owner could own an 80% share of the property and another owner could own a 20% share of the property. These percentages must add up to 100%. Tenant-in-common owners do not have the right of survivorship. If a tenant in common passes away, their share of the property goes to their estate instead of the remaining tenants in common."},
      {"Joint Tenancy": "Joint Tenancy",
        "help": "**Joint tenant** owners all own an equal share of the property. For example, if there are three joint tenant owners, each owner owns 1/3rd of the property. Joint tenant owners also have what the law calls a 'right of survivorship.' This means that when a joint tenant owner passes away, their share of the property goes to the other joint tenant owners."},
      {"I do not know": "I do not know."}]   
---
id: shared owners type
question: |
  What type of ownership do you have?
subquestion: |
  There are a few different ways multiple people can own a property. Your deed or conveyance document may have this informaton.
field: shared_owners_type
choices:
  code: |
    ownership_types
---
id: tenant in common explanation
continue button field: common_explanation
question: |
  Tenancy in common
subquestion: |
  As you are a **tenant in common**, you and the other owners must make separate TODIs. Your TODI will transfer your share of the property to your beneficiaries.
---
id: joint tenant explanation
continue button field: joint_explanation
question: |
  Joint tenancy
subquestion: |
  As you are a **joint tenant** owner, you and the other owners could file a TODI together. However, this program can only make a TODI for a single owner.
  
  You and the other owners can each file your own TODIs, but only the TODI of the owner who passes away last would take effect.
---
id: tenant entirety explanation
continue button field: entirety_explanation
question: |
  Tenancy in the entirety
subquestion: |
  As you and your spouse are **tenants in the entirety**, you could file a TODI together if you both agree who should get the home after you both pass away. However, this program can only make a TODI for a single owner.

  If you and your spouse do not agree about who would get the home after you both pass away, you can each file your own TODIs. Only the TODI of the owner who passes away last would take effect.
---
id: unknown kickout
event: unknown_kickout
question: |
  Sorry
subquestion: |
  You should not use this program if you do not know what type of shared ownership you have. Your deed or conveyance document may have this information. If your deed does not say, **tenancy in common** is the default. However, you may want to [**Get Legal Help**]("https://www.illinoislegalaid.org/get-legal-help") 
buttons:
  - Exit: exit
  - Restart: restart
---
id: any other beneficiaries
question: |
  Do you have any other beneficiaries to tell us about?
subquestion: |
  So far you have told us about ${comma_and_list(beneficiaries.complete_elements().full_names())}.
fields:
  - "Anyone else?": beneficiaries.there_is_another
    datatype: yesnoradio
---
code: |
  beneficiaries[i].name.first
  beneficiaries[i].address.address
  if beneficiaries[i].benefits == True:
    benefits_explainer
  beneficiaries[i].relationship
  if beneficiaries[i].has_successor == True:
    beneficiaries[i].successor_beneficiary.name.first
    beneficiaries[i].successor_beneficiary.address.city
    beneficiaries[i].successor_beneficiary.relationship
  elif beneficiaries[i].relationship == "Child":
    child_notice
  beneficiaries[i].complete = True 
---
sets:
  - beneficiaries[i].name.first
id: names of beneficiaries
question: |
  What is the ${ordinal(i)} beneficiary's name?
subquestion: |
  % if i == 0:
  A beneficiary is the person you want to get your property or a share of your property after you pass away.
  % endif
fields:
  - First: beneficiaries[i].name.first
  - Middle: beneficiaries[i].name.middle
    required: False
  - Last: beneficiaries[i].name.last
  - Suffix: beneficiaries[i].name.suffix
    code: |
      name_suffix()
    required: False  
---
id: beneficiary address
sets:
  - beneficiaries[i].address.address
question: |
  What is ${beneficiaries[i].name.full(middle='full')}'s address?
fields:
  - Street address: beneficiaries[i].address.address
    address autocomplete: True
  - Address line 2: beneficiaries[i].address.unit
    required: False
  - City: beneficiaries[i].address.city
  - State: beneficiaries[i].address.state
    code: |
      states_list() 
  - ZIP code: beneficiaries[i].address.zip  
---
id: beneficiary relationship
sets:
  - beneficiaries[i].relationship
question: |
  What is ${beneficiaries[i].name.full(middle='full')}'s relationship to you?
fields: 
  - Relationship: beneficiaries[i].relationship_radio
    input type: radio
    choices:
    - Parent
    - Child
    - Grandchild
    - Sibling
    - Cousin
    - Other
  - Other: beneficiaries[i].relationship
    show if: 
      variable: beneficiaries[i].relationship_radio
      is: "Other"     
---
sets:
  beneficiaries[i].relationship
depends on:
  - beneficiaries[i].relationship_radio
code: |
  if beneficiaries[i].relationship_radio != "Other":
    beneficiaries[i].relationship = beneficiaries[i].relationship_radio 
---
id: beneficiary benefits
question: |
  Does ${beneficiaries[i].name.full(middle='full')} receive any public benefits?
subquestion: |
  Public benefits include SNAP (food stamps), Social Security Disability Insurance (SSDI), or Supplemental Security Income (SSI).
fields:
  - no label: beneficiaries[i].benefits
    datatype: yesnoradio  
---
id: benefits explainer
continue button field: benefits_explainer
question: |
  Note about public benefits
subquestion: |
  Some public benefits programs have asset limitations. 
  
  In other words, it is possible that receiving an ownership interest in a home could disqualify someone from the public benefit they receive.
  
  You may wish to speak to ${beneficiaries[i].name.full(middle='full')} or a lawyer about this before moving forward.
---
sets:
  - beneficiaries[i].has_successor
id: successor beneficiary check
question: |
  Would you like to name a successor beneficiary for ${beneficiaries[i].name.full(middle='full')}?
subquestion: |
  A successor beneficiary is a loved one who will inherit the property if ${beneficiaries[i].name.full(middle='full')} passes away before you do.
  
  % if beneficiaries[i].relationship_radio == "Child":
  **Note:** If you do not name a successor beneficiary and your child passes away before you do, your child's share in your home will go to any surviving children of your child.
  % endif
fields:
  - no label: beneficiaries[i].has_successor
    datatype: yesnoradio 
---
id: child notice
continue button field: child_notice
question: |
  Note about child beneficiaries
subquestion: |
   If you do not name a successor beneficiary and your child passes away before you do, your child's share in your home will go to any surviving children of your child.
---
id: probate warning
continue button field: probate_warning
question: |
  Note about probate
subquestion: |
  If you do not name a successor beneficiary and ${beneficiaries[0].name.full(middle='full')} passes away before you, your home would go through your estate. This would require your heirs to go through probate court. 
---
sets:
  - first_pass
  - running_total
code: |
  first_pass = True
  running_total = 0
---
sets:
  - beneficiaries[i].successor_beneficiary.name.first
id: names of beneficiaries
question: |
  What is the name of the successor beneficiary for ${beneficiaries[i].name.full(middle='full')}?
fields:
  - First: beneficiaries[i].successor_beneficiary.name.first
  - Middle: beneficiaries[i].successor_beneficiary.name.middle
    required: False
  - Last: beneficiaries[i].successor_beneficiary.name.last
  - Suffix: beneficiaries[i].successor_beneficiary.name.suffix
    code: |
      name_suffix()
    required: False  
---
id: successor location
question: |
  Where does ${beneficiaries[i].successor_beneficiary.name.full(middle='full')} live?
fields:
  - City: beneficiaries[i].successor_beneficiary.address.city
  - State: beneficiaries[i].successor_beneficiary.address.state
    code: |
      states_list() 
---
id: successor relationship
question: |
  What is ${beneficiaries[i].successor_beneficiary.name.full(middle='full')}'s relationship to you?
fields: 
  - Relationship: beneficiaries[i].successor_beneficiary.relationship_radio
    input type: radio
    choices:
    - Parent
    - Child
    - Grandchild
    - Sibling
    - Cousin
    - Other
  - Other: beneficiaries[i].successor_beneficiary.relationship
    show if: 
      variable: beneficiaries[i].successor_beneficiary.relationship_radio
      is: "Other"
---
sets:
  beneficiaries[i].successor_beneficiary.relationship
depends on:
  - beneficiaries[i].successor_beneficiary.relationship_radio
code: |
  if beneficiaries[i].successor_beneficiary.relationship_radio != "Other":
    beneficiaries[i].successor_beneficiary.relationship = beneficiaries[i].successor_beneficiary.relationship_radio 
---
code: |
  tenancy_type = "Joint tenants"
  error_switch = True
---
sets:
  - tenancy_type
id: tenancy type
question: |
  Would you like your beneficiaries to be **joint tenants** or **tenants in common**?
field: tenancy_type
choices:
  - Joint tenants: Joint tenants
    help: |
      **Joint tenant** owners all own an equal share of the property. For example, if there are three joint tenant owners, each owner owns 1/3rd of the property. Joint tenant owners also have what the law calls a "right of survivorship." This means that when a joint tenant owner passes away, their share of the property goes to the other joint tenant owners.  
  - Tenants in common: Tenants in common
    help: |
      **Tenants in common** may have equal or unequal shares. For example, one owner could own an 80% share of the property and another owner could own a 20% share of the property. These percentages must add up to 100%. Tenant-in-common owners do not have the right of survivorship. If a tenant in common passes away, their share of the property goes to their estate instead of the remaining tenants in common.
---
id: tenancy alt intro
continue button field: alt_tenancy_intro
question: |
  Tenants in common requirement
subquestion: |
  Because you own your share of the property as a tenant in common, your beneficiaries must inherit as tenants in common.
  
  Tenants in common may have **equal or unequal shares**. For example, one owner could own an 80% share of the property and another owner could own a 20% share of the property. These percentages must add up to 100%. Tenant-in-common owners do not have the right of survivorship. If a tenant in common passes away, **their share of the property goes to their estate instead of to the remaining tenants in common**.
---
depends on:
  - beneficiary_count
code: |
  equal_share_reference = 100 / beneficiaries.number_gathered()
---
code: |
  beneficiary_count = beneficiaries.number_gathered()
---
reset:
  - beneficiary_count 
  - equal_share_reference
  - error_switch
  - share_calculator
  - nested_share_code
---
depends on:
  - equal_share_reference
  #- tenancy_type
  - even_split
  - beneficiary_count
code: |
  if beneficiary_count  != 1:
    equal_share_reference
    if other_owners_check == "multiple" and shared_owners_type == "Tenancy in common":
      alt_tenancy_intro
      tenancy_type = "Tenants in common"
    if tenancy_type == "Tenants in common":
      even_split
    nested_share_code
  else:
    if beneficiaries[0].relationship != "Child":
      if beneficiaries[0].has_successor == False:
        probate_warning
  share_calculator = True
---
depends on:
  - equal_share_reference
  - tenancy_type
  - even_split
  - beneficiary_count
code: |
  if tenancy_type == "Joint tenants" or even_split == True:
    for person in beneficiaries:
      person.percent_share = equal_share_reference
  else:
    running_total = 0
    share_reset
    for person in beneficiaries:
      person.percent_share
      running_total = running_total + person.percent_share
    if running_total != 100 and tenancy_type == "Tenants in common":
      if other_owners_check == "multiple" and shared_owners_type == "Tenancy in common":
        percent_kickout
      else:
        percent_error
        error_switch
  nested_share_code = True
---
depends on:
  - equal_share_reference
  - tenancy_type
  - even_split
  - beneficiary_count
code: |
  for person in beneficiaries:
    undefine('person.percent_share')
  share_reset = True
---
depends on:
  - tenancy_type
  - beneficiary_count
id: even split
question: |
  How do you want to split the property between your beneficiaries?
field: even_split
choices:
  - "An equal amount (${thousands((100 / beneficiaries.number_gathered()), show_decimals = True)}%) for each person" : True
  - "Different amounts for each person" : False  
#fields:
  #- no label: even_split
    #datatype: yesnoradio
---
sets:
  - beneficiaries[i].percent_share
depends on:
  - tenancy_type
  - even_split
  - beneficiary_count
id: beneficiary share
question: |
  What is ${beneficiaries[i].name.full(middle='full')}'s percent share of the property?
subquestion: |
  % if i > 0:
  
  % for person in beneficiaries:
  % if beneficiaries.index(person) < i:
  * ${person.name.full(middle='full')}'s share is ${person.percent_share}%.  
  % else:
  * ${person.name.full(middle='full')}'s share is 0%.
  % endif
  % endfor
  % endif
  
  The total percentage you have listed so far is ${running_total}%.
fields:
  - ${beneficiaries[i].name.full(middle='full')}'s percent share: beneficiaries[i].percent_share
    datatype: number
    min: 0.01
    max: 99.99
---
depends on:
  - beneficiary_count 
code: |
  if beneficiary_count  == 1:
    beneficiaries[0].percent_share = 100
  else:
    undefine(beneficiaries[0].percent_share)  
  percent_default = True
---
id: running total calculate
event: running_total_calculate
question: |
  Filler text
---
terms:
  joint tenants: |
    **Joint tenant** owners all own an equal share of the property. For example, if there are three joint tenant owners, each owner owns 1/3rd of the property. Joint tenant owners also have what the law calls a right of survivorship. This means that when a joint tenant owner passes away, their share of the property goes to the other joint tenant owners.
  tenants in common: |
    **Tenants in common** may have equal or unequal shares. For example, one owner could own an 80% share of the property and another owner could own a 20% share of the property. These percentages must add up to 100%. Tenant-in-common owners do not have the right of survivorship. If a tenant in common passes away, their share of the property goes to their estate instead of the remaining tenants in common.
---
id: percent error
continue button field: percent_error
question: |
  Shares do not add up to 100%
subquestion: |

  % for person in beneficiaries:
  * ${person.name.full(middle='full')}'s share is ${person.percent_share}%.
  % endfor
  
  The percentages you listed for each beneficiary add up to ${running_total}%. They should add up to 100%. 
  
  If you click **Next**, this program will consider your beneficiaries **{joint tenants}** instead of **{tenants in common}**.
  
  If you would like to edit the percentages, click **Back**.
---
#This kickout exists for when there is a percentage is but the ownership cannot be converted to a joint tenancy.
id: percent kickout
event: percent_kickout
question: |
  Shares do not add up to 100%
subquestion: |
  The percentages you listed for each beneficiary add up to ${running_total}%. They should add up to 100%.
  
  If you would like to edit the percentages, click **Back**.
buttons:
  - Exit: exit
  - Restart: restart
---
id: first witness known
question: |
  Do you know who will be your first witness?
subquestion: |
  You will need to have two witnesses sign the TODI with you in front of a notary public. You don't need to know who your witnesses will be right now, but you will need to add their names and addresses later.
  
  Your beneficiaries cannot serve as witnesses.
fields:
  - no label: first_witness_known
    datatype: yesnoradio
---
id: second witness known
question: |
  Do you know who will be your second witness?
subquestion: |
  You will need to have two witnesses sign the TODI with you in front of a notary public. You don't need to know who your witnesses will be right now, but you will need to add their names and addresses later.
  % if first_witness_known == True:
  You said ${witnesses[0].name.full(middle="full") } will be your other witness. Your beneficiaries cannot serve as witnesses.
  % else:
  Your beneficiaries cannot serve as witnesses.
  % endif
fields:
  - no label: second_witness_known
    datatype: yesnoradio
---
only sets: 
  - set_second_witness_unknown
code: |
  if first_witness_known == False:
    second_witness_known = False
  set_second_witness_unknown = True
---
id: witness name
question: |
  What is the name of your ${ ordinal(i) } witness?
fields:
  - First: witnesses[i].name.first
  - Middle: witnesses[i].name.middle
    required: False
  - Last: witnesses[i].name.last  
---
id: address known
question: |
  Do you know ${witnesses[0].name.full(middle="full") }'s address?
subquestion: |
  If you do not know this now, you can add it when ${witnesses[0].name.full(middle="full") } signs the TODI as your witness.
fields:
  - no label: first_witness_address_known
    datatype: yesnoradio
---
id: second address known
question: |
  Do you know ${witnesses[1].name.full(middle="full") }'s address?
subquestion: |
  If you do not know this now, you can add it when ${witnesses[1].name.full(middle="full") } signs the TODI as your witness.
fields:
  - no label: second_witness_address_known
    datatype: yesnoradio
---
id: witness address
question: |
  What is ${witnesses[i].name.full(middle="full") }'s address?
subquestion: |
  If you do not know this now, click **Back**.
fields:
  - Street address: witnesses[i].address.address
    address autocomplete: True
  - Address line 2: witnesses[i].address.unit
    required: False
  - City: witnesses[i].address.city
  - State: witnesses[i].address.state
    code: |
      states_list() 
  - ZIP code: witnesses[i].address.zip
---
id: get docs screen
event: get_docs_screen
question: |
  Download
subquestion: |
  Your form is ready. View and download your form below. Click **Make changes** to fix any mistakes.
  
  Read the instructions to learn what to do next.

  Thank you for using ILAO Easy Forms!
  
  ${ action_button_html(url_action('review_answers'), label=':edit: Make changes', color='success', size="md") }

  ${ al_user_bundle.download_list_html() }
 
  &nbsp;

  ${ al_user_bundle.send_button_html(show_editable_checkbox=False) }
  
  **Note:** This program does not send your form. You will need to do this yourself.

  Thank you for using ILAO Easy Forms!
under: |
  % if not user_logged_in():
  [${fa_icon("sign-in-alt", color="#0079d0", size="sm")} **Sign-in**](${url_of('login', next=interview_url())}) or [**create**](${url_of('register', next=interview_url())}) an ILAO Easy Form account to save your progress (optional).
  % endif

 
  ${ action_button_html(interview_url(i="docassemble.ILAO:feedback.yml", easy_form_interview=ilao_easy_form_url, easy_form_title=ilao_easy_form_title, easy_form_page=user_info().question_id, easy_form_variable=user_info().variable, local=False,reset=1), label=':comment: Was this program helpful?', color="#181c36", size="md", new_window=True) }
---
generic object: ALDocumentBundle
template: x.send_email_template
subject: |
  Transfer on death instrument
content: |
  Your forms are attached.
  
  Thanks for using ILAO Easy Forms!
  
  [**Illinois Legal Aid Online**](https://www.illinoislegalaid.org)
---
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[instructions, todi], filename="transfer_on_death_instrument.pdf", title="Download all forms", enabled=True)
  - al_court_bundle: ALDocumentBundle.using(elements=[intsructions, todi], filename="transfer_on_death_instrument", title="Download all forms", enabled=True)
---
attachment:
  - name: todi
    variable name: todi[i]
    filename: transfer_on_death_instrument
    docx template file: todi_docassemble.docx
---
attachment:
  - name: instructions
    variable name: instructions[i]
    filename: instructions
    docx template file: todi_instructions.docx
---
objects:
  - todi: ALDocument.using(title="TODI and Affidavit", filename="todi", enabled=True, has_addendum=False)
  - instructions: ALDocument.using(title="Instructions", filename="instructions", enabled=True, has_addendum=False)
---
id: review screen
event: review_answers
question: |
  Review screen
subquestion: |
  Edit your answers below.
review: 
  - Edit: user.name.first
    button: |
      **Your name:**
      ${user.name.full(middle='full')}
  - Edit: user.address.address
    button: |
      **Your address:**
      ${user.address.on_one_line(bare=True)}
  - Edit: user.address.county
    button: |
      **Your County:**
      ${user.address.county}
  - Edit: user.include_phone
    button: |
      **Do you want to include your phone number?**
      ${word(yesno(user.include_phone))}
  - Edit: user.phone_number
    button: |
      **Your phone number:**
      ${phone_number_formatted(user.phone_number)}
    show if: user.include_phone
  - Edit: user.include_email
    button: |
      **Do you want to include your email address?**
      ${word(yesno(user.include_email))}
  - Edit: user.email
    button: |
      **Your email address:**
      ${user.email}
    show if: user.include_email
  - Edit: user.marital_status
    button: |
      **Your marital status:**
      ${user.marital_status}
  - Edit: todi_property.address
    button: |
      **Address of the property:**
      ${todi_property.on_one_line(bare=True)}
  - Edit: todi_property.county
    button: |
      **Property location:**
      ${todi_property.county}
  - Edit: 
      - trial_court_index
      - recompute:
        - trial_court
    button: |
      **Property location:**
      ${ trial_court.address.county } County
  - Edit: todi_property.pin
    button: |
      **Property Identification Number:**
      ${todi_property.pin}
  - Edit: todi_property.description
    button: |
      **The property's legal description:**
      ${todi_property.description}
  - Edit: other_owners_check
    button: |
      **Who owns this property?**
      % if other_owners_check == "sole":
      I am the only owner.
      % else:
      I share this property with someone else.
      % endif
  - Edit: shared_owners_type
    button: |
      **Type of shared ownership:**
      ${shared_owners_type}
    show if: other_owners_check != "sole"
  - Edit: beneficiaries.revisit
    button: |
      **Beneficiaries: (Edit to change names, addresses, and successors)**

      % for my_var in beneficiaries:
        * ${ my_var.name.full(middle="full") }
      % endfor
  - Edit: tenancy_type
    button: |
      **Beneficiaries' tenancy:**
        ${tenancy_type}
    show if: beneficiary_count  != 1
  - Edit: first_witness_known
    button: |
      **Do you know who will be the first witness?**
      ${word(yesno(first_witness_known))}
  - Edit: witnesses[0].name.first
    button: |
      **First witness's name:**
      ${witnesses[0].name.full(middle='full')}
    show if: first_witness_known
  - Edit: first_witness_address_known
    button: |
      **Do you know ${witnesses[0].name.full(middle='full')}'s address?**
      ${word(yesno(first_witness_address_known))}
    show if: first_witness_known
  - Edit: witnesses[0].address.address
    button: |
      **${witnesses[0].name.full(middle='full')}'s address:**
      ${witnesses[0].address.on_one_line(bare=True)}
    show if: first_witness_known == True and first_witness_address_known == True 
  - Edit: second_witness_known
    button: |
      **Do you know who will be the second witness?**
      ${word(yesno(second_witness_known))}
  - Edit: witnesses[1].name.first
    button: |
      **Second witness's name:**
      ${witnesses[1].name.full(middle='full')}
    show if: second_witness_known == True
  - Edit: second_witness_address_known
    button: |
      **Do you know ${witnesses[1].name.full(middle='full')}'s address?**
      ${word(yesno(second_witness_address_known))}
    show if: second_witness_known == True
  - Edit: witnesses[1].address.address
    button: |
      **${witnesses[1].name.full(middle='full')}'s address:**
      ${witnesses[1].address.on_one_line(bare=True)}
    show if: second_witness_known == True and second_witness_address_known == True
---
id: beneficiaries review
continue button field: beneficiaries.revisit
question: |
  Edit the information about the beneficiaries
subquestion: |
  ${ beneficiaries.table }

  ${ beneficiaries.add_action() }
---
id: beneficiaries table
table: beneficiaries.table
rows: beneficiaries
columns:
  - Name: |
      row_item.name.full(middle="full") if defined("row_item.name.first") else ""
  - Address, phone number, relationship, share, and successor: |
      action_button_html(url_action(row_item.attr_name("review_beneficiary")), label="Edit", icon="pencil-alt")
delete buttons: True
confirm: True
---
id: review user
event: section_user
question: |
  About you
subquestion: |
  Edit your answers below.
review:
  - Edit: user.name.first
    button: |
      **Your name:**
      ${user.name.full(middle='full')}
  - Edit: user.address.address
    button: |
      **Your address:**
      ${user.address.on_one_line(bare=True)}
  - Edit: user.address.county
    button: |
      **Your County:**
      ${user.address.county}
  - Edit: user.include_phone
    button: |
      **Do you want to include your phone number?**
      ${word(yesno(user.include_phone))}
  - Edit: user.phone_number
    button: |
      **Your phone number:**
      ${phone_number_formatted(user.phone_number)}
    show if: user.include_phone
  - Edit: user.include_email
    button: |
      **Do you want to include your email address?**
      ${word(yesno(user.include_email))}
  - Edit: user.email
    button: |
      **Your email address:**
      ${user.email}
    show if: user.include_email
  - Edit: user.marital_status
    button: |
      **Your marital status:**
      ${user.marital_status}
---
id: review beneficiaries
event: section_beneficiaries
question: |
  Beneficiaries
subquestion: |
  Edit your answers below.
review:
  - Edit: beneficiaries.revisit
    button: |
      **Beneficiaries: (Edit to change names, addresses, and successors)**

      % for my_var in beneficiaries:
        * ${ my_var.name.full(middle="full") }
      % endfor
  - Edit: tenancy_type
    button: |
      **Beneficiaries' tenancy:**
        ${tenancy_type}
    show if: beneficiary_count  != 1
---
id: review property
event: section_property
question: |
  Property
subquestion: |
  Edit your answers below.
review:
  - Edit: todi_property.address
    button: |
      **Address of the property:**
      ${todi_property.on_one_line(bare=True)},
  - Edit: todi_property.county
    button: |
      **Property location:**
      ${todi_property.county}
  - Edit: 
      - trial_court_index
      - recompute:
        - trial_court
    button: |
      **Property location:**
      ${ trial_court.address.county } County
  - Edit: todi_property.pin
    button: |
      **Property Identification Number:**
      ${todi_property.pin}
  - Edit: todi_property.description
    button: |
      **The property's legal description:**
      ${todi_property.description}
  - Edit: other_owners_check
    button: |
      **Who owns this property?**
      % if other_owners_check == "sole":
      I am the only owner.
      % else:
      I share this property with someone else.
      % endif
  - Edit: shared_owners_type
    button: |
      **Type of shared ownership:**
      ${shared_owners_type}
    show if: other_owners_check != "sole"
---
id: review witnesses
event: section_witnesses
question: |
  Witnesses
subquestion: |
  Edit your answers below.
review:
  - Edit: first_witness_known
    button: |
      **Do you know who will be the first witness?**
      ${word(yesno(first_witness_known))}
  - Edit: witnesses[0].name.first
    button: |
      **First witness's name:**
      ${witnesses[0].name.full(middle='full')}
    show if: first_witness_known
  - Edit: first_witness_address_known
    button: |
      **Do you know ${witnesses[0].name.full(middle='full')}'s address?**
      ${word(yesno(first_witness_address_known))}
    show if: first_witness_known
  - Edit: witnesses[0].address.address
    button: |
      **${witnesses[0].name.full(middle='full')}'s address:**
      ${witnesses[0].address.on_one_line(bare=True)}
    show if: first_witness_known == True and first_witness_address_known == True 
  - Edit: second_witness_known
    button: |
      **Do you know who will be the second witness?**
      ${word(yesno(second_witness_known))}
  - Edit: witnesses[1].name.first
    button: |
      **Second witness's name:**
      ${witnesses[1].name.full(middle='full')}
    show if: second_witness_known == True
  - Edit: second_witness_address_known
    button: |
      **Do you know ${witnesses[1].name.full(middle='full')}'s address?**
      ${word(yesno(second_witness_address_known))}
    show if: second_witness_known == True
  - Edit: witnesses[1].address.address
    button: |
      **${witnesses[1].name.full(middle='full')}'s address:**
      ${witnesses[1].address.on_one_line(bare=True)}
    show if: second_witness_known == True and second_witness_address_known == True
---
id: beneficiary review
continue button field: x.review_beneficiary
generic object: ALIndividual
question: |
  Edit ${x.name.full(middle='full')}'s information
review: 
  - Edit: x.name.first
    button: |
      **Beneficiary name:**
      ${ x.name.full(middle="full")  }
  - Edit: x.address.address
    button: |
      **${ x.name.full(middle="full") }'s address: **
      ${ x.address.on_one_line(bare=True) }
  - Edit: x.phone_number
    button: |
      **${ x.name.full(middle="full") }'s phone number:**
      ${ phone_number_formatted(x.phone_number) }
  - Edit: x.relationship
    button: |
      **${x.name.full(middle='full')}'s relationship to you:**
      ${x.relationship}
  - Edit: x.percent_share
    button: |
      **${ x.name.full(middle="full") }'s share of the property:**
      ${x.percent_share}%
    show if: beneficiary_count  > 1
  - Edit: x.has_successor
    button: |
      **Does ${x.name.full(middle='full')} have a successor beneficiary?**
      ${word(yesno(x.has_successor))}
  - Edit: x.successor_beneficiary.name.first
    button: |
      **Successor beneficiary's name:**
      ${x.successor_beneficiary.name.full(middle='full')}
    show if: x.has_successor == True
  - Edit: x.successor_beneficiary.address.city
    button: |
      **${x.successor_beneficiary.name.full(middle='full')}'s location:**
      ${x.successor_beneficiary.address.city}, ${x.successor_beneficiary.address.state}
    show if: x.has_successor == True
  - Edit: x.successor_beneficiary.relationship
    button: |
      **${x.successor_beneficiary.name.full(middle='full')}'s relationship to you:**
      ${x.successor_beneficiary.relationship}
    show if: x.has_successor == True